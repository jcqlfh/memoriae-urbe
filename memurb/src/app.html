<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Memoriae Urbe</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Material Icons -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <!-- Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,600,700" />
    <!-- Roboto Mono -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Julius+Sans+One" />
    <!-- Julius Sans One  -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono" /> %svelte.head%
    <!-- Google Auth -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <meta name="google-signin-client_id" content="">
    <script language="JavaScript" type="text/javascript" src="https://kjur.github.io/jsrsasign/jsrsasign-latest-all-min.js"></script>
    <script>
        function handleCredentialResponse(CredentialResponse) {
            try {
                // Get credential and payload
                var cred = CredentialResponse.credential;
                var payload = KJUR.jws.JWS.readSafeJSONString(b64utoutf8(cred.split(".")[1]));;
                // Gets or creates the user
                var user = getUser(payload)
                if (!user)
                    user = createUser(payload);

                updateStorage(user);
                // Redirects
                window.location.assign('/home.html');
            } catch {
                console.log("erro ao logar");
            }
        }

        function getUser(payload) {
            return {
                name: payload.name,
                email: payload.email
            };
        }

        function createUser(payload) {
            return {
                name: payload.name,
                email: payload.email
            };
        }

        function updateStorage(user) {
            localStorage.setItem("MEMURB_USER", user);
        }
    </script>
</head>

<body>
    %svelte.body%
</body>

</html>